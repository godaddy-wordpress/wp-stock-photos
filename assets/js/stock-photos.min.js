!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=wp.media.model.Query.extend({sync:function(a,b,c){var d;return c=c||{},c.context=this,c.data=_.extend(c.data||{},{action:"wpaas_stock_photos_get"}),d=_.clone(this.args),-1!==d.posts_per_page&&(d.paged=Math.round(this.length/d.posts_per_page)+1),c.data.query=d,wp.media.ajax(c)}},{get:function(){var a=[];return function(b,c){var e,f=d,g={},h=!!b.cache||_.isUndefined(b.cache);return delete b.query,delete b.cache,_.each(b,function(a,b){_.isNull(a)||(g[b]=a)}),_.defaults(g,f.defaultArgs),h?e=_.find(a,function(a){return _.isEqual(a.args,g)}):a=[],e||(e=new f([],_.extend(c||{},{props:b,args:g})),a.push(e)),e}}()});b.exports=d},{}],2:[function(a,b,c){var d=a("./stock-photos-query"),e=wp.media.model.Attachments.extend({initialize:function(a,b){wp.media.model.Attachments.prototype.initialize.call(this,a,b),this.StockPhotosProps=new Backbone.Model,this.StockPhotosProps.set("importing",!1),this.StockPhotosProps.set("previewing",!1)},_requery:function(a){var b;this.props.get("query")&&(b=this.props.toJSON(),b.cache=!0!==a,this.mirror(d.get(b)))}});b.exports=e},{"./stock-photos-query":1}],3:[function(a,b,c){var d=a("./models/stock-photos.js"),e=a("./views/browser/stock-photos.js"),f=a("./views/preview/stock-photo.js"),g=wp.media.view.MediaFrame.Select.prototype.bindHandlers;wp.media.view.MediaFrame.Select.prototype.bindHandlers=function(){g.apply(this,arguments);var a=!1;this.on("content:render:wpaas_stock_photos",function(){function b(){var a=h.StockPhotosProps.get("previewing");return a?(this.content.set(new f({controller:this,collection:h,model:a})),this.$el.removeClass("hide-toolbar"),void this.toolbar.mode("wpaas-stock-photos-preview")):(this.$el.addClass("hide-toolbar"),this.content.set(new e({controller:this,collection:h})),void this.toolbar.mode(i))}var c,g=this.state(),h=g.get("wpaas_stock_photos"),i=this.toolbar.mode();_.isUndefined(h)&&(h=new d(null,{props:{query:!0,category:"generic"}}),g.set("wpaas_stock_photos",h)),c=_.bind(b,this),a||this.listenTo(h.StockPhotosProps,"change:previewing",c),a=!0,c()},this),this.on("toolbar:create:wpaas-stock-photos-preview",this.createToolbar,this),this.on("toolbar:render:wpaas-stock-photos-preview",function(a){var b=this;a.set("import",{text:wpaas_stock_photos.import_btn,style:"primary",priority:80,click:function(){var a=b.state(),c=a.get("wpaas_stock_photos").StockPhotosProps;c.set("importing",c.get("previewing").get("id")),c.set("previewing",!1)}})},this);var b=!1;this.on("toolbar:render:select",function(a){return b?void a.set("select",_.clone(b)):void(b=_.extend({style:"primary",text:a.options.text},a.options.items.select))},this)};var h=wp.media.view.MediaFrame.Select.prototype.browseRouter;wp.media.view.MediaFrame.Select.prototype.browseRouter=function(a){h.apply(this,arguments),a.set({wpaas_stock_photos:{text:wpaas_stock_photos.menu_title,priority:30}})};var i=wp.media.controller.Library.prototype.uploading;wp.media.controller.Library.prototype.uploading=function(){"wpaas_stock_photos"===this.frame.content.mode()&&this.frame.content.mode("browse"),i.apply(this,arguments)}},{"./models/stock-photos.js":2,"./views/browser/stock-photos.js":6,"./views/preview/stock-photo.js":8}],4:[function(a,b,c){var d=wp.media.view.Attachment.extend({events:{click:"previewImage"},initialize:function(){wp.media.view.Attachment.prototype.initialize.apply(this,arguments),this.listenTo(this.collection.StockPhotosProps,"change:importing",this.toggleState)},render:function(){wp.media.view.Attachment.prototype.render.apply(this,arguments);var a=jQuery(this.$el.wrapAll("<div>").parent().html());return a.find(".thumbnail").before('<span class="import">'+wpaas_stock_photos.preview_btn+'</span><span class="spinner"></span>'),this.toggleState(),this.$el.html(a.html()),this},previewImage:function(a){a.preventDefault(),this.collection.StockPhotosProps.set("previewing",this.model)},downloadImage:function(){var a=this;wp.media.ajax({data:{action:"wpaas_stock_photos_download",filename:this.model.get("filename"),id:this.model.get("id"),nonce:this.model.get("nonces").download}}).done(function(a){var b=wp.media.frame.content.mode("browse");b.get("gallery").collection.add(a),b.get("selection").collection.add(a),wp.Uploader.queue.add(a),wp.Uploader.queue.remove(a),b.get("gallery").$("li:first .thumbnail").click()}).fail(function(){}).always(function(){a.collection.StockPhotosProps.set("importing",!1),a.toggleState(),a.$el.blur()})},toggleState:function(){var a=this.collection.StockPhotosProps.get("importing");return a?(this.model.get("id")===a&&(this.$el.addClass("importing"),this.downloadImage(a)),void this.$el.addClass("inactive")):void this.$el.removeClass("inactive importing")}});b.exports=d},{}],5:[function(a,b,c){var d=wp.media.view.AttachmentFilters.extend({initialize:function(){var a=this;if(wp.media.view.AttachmentFilters.prototype.initialize.apply(this,arguments),this.StockPhotosProps=arguments[0].StockPhotosProps,this.listenTo(this.StockPhotosProps,"change:importing",this.toggleState),this.toggleState(),_.isUndefined(wpaas_stock_photos.select2)){var b=_.isUndefined(jQuery.fn.select2)?null:jQuery.fn.select2;jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css"}).appendTo("head"),jQuery.ajax({url:"https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js",dataType:"script",success:function(){wpaas_stock_photos.select2=jQuery.fn.select2,jQuery.fn.select2=b,a.addSelect2()},async:!0})}},createFilters:function(){this.filters={};var a=this,b=10;_.each(wpaas_stock_photos.cat_choices,function(c,d){b+=10;var e="generic"===d?"all":d;a.filters[e]={text:c,props:{category:d},priority:b}})},toggleState:function(){return this.StockPhotosProps.get("importing")?void this.$el.prop("disabled","disabled"):void this.$el.removeProp("disabled")},ready:function(){_.isUndefined(wpaas_stock_photos.select2)||this.$el.data("select2")||this.addSelect2()},addSelect2:function(){wpaas_stock_photos.select2.call(this.$el);var a=this.$el,b=a.data("select2");b.$container.addClass("wpaas-stock-photos"),b.$dropdown.addClass("wpaas-stock-photos"),a.on("select2:open",function(){jQuery(document.body).off("mousedown.select2.select2-"+a.attr("id")),jQuery(document.body).on("mousedown.select2.select2-"+a.attr("id"),function(b){var c=jQuery(b.target),d=c.closest(".select2"),e=jQuery(".select2.select2-container--open");e.each(function(){this!=d[0]&&wpaas_stock_photos.select2.call(a,"close")})})})}});b.exports=d},{}],6:[function(a,b,c){var d=a("./stock-photos-filter.js"),e=a("./stock-photo.js"),f=wp.media.view.Frame.extend({tagName:"div",className:"wpaas-stock-photos attachments-browser",initialize:function(){this.createToolbar(),this.createAttachments(),this.updateContent(),this.listenTo(this.collection,"add remove reset",_.bind(this.updateContent,this))},createToolbar:function(){var a;a={controller:this.controller},this.toolbar=new wp.media.view.Toolbar(a),this.views.add(this.toolbar),this.toolbar.set("spinner",new wp.media.view.Spinner({priority:-60})),this.toolbar.set("filtersLabel",new wp.media.view.Label({value:wpaas_stock_photos.filter_label,attributes:{"for":"media-attachment-filters"},priority:-80}).render()),this.toolbar.set("filters",new d({controller:this.controller,model:this.collection.props,StockPhotosProps:this.collection.StockPhotosProps,priority:-80}).render())},createAttachments:function(){this.attachments=new wp.media.view.Attachments({controller:this.controller,collection:this.collection,AttachmentView:e}),this.views.add(this.attachments),this.attachmentsNoResults=new wp.media.View({controller:this.controller,tagName:"div",className:"uploader-inline"}),this.attachmentsNoResults.$el.addClass("hidden"),this.attachmentsNoResults.$el.html('<div class="uploader-inline-content has-upload-message"><h2 class="upload-message">'+wpaas_stock_photos.no_images+"</h2></div>"),this.views.add(this.attachmentsNoResults)},updateContent:function(){var a=this;return this.toolbar.get("spinner").show(),this.collection.length?(a.attachmentsNoResults.$el.addClass("hidden"),void a.toolbar.get("spinner").hide()):void this.collection.more().always(function(){a.collection.length?a.attachmentsNoResults.$el.addClass("hidden"):a.attachmentsNoResults.$el.removeClass("hidden"),a.toolbar.get("spinner").hide()})}});b.exports=f},{"./stock-photo.js":4,"./stock-photos-filter.js":5}],7:[function(a,b,c){var d=wp.media.View.extend({tagName:"h2",className:"backBtn",events:{click:"goBack"},render:function(){return this.$el.text(wpaas_stock_photos.back_btn),this},goBack:function(){this.unbind(),this.remove(),this.trigger("close"),this.collection.StockPhotosProps.get("previewing")&&this.collection.StockPhotosProps.set("previewing",!1)}});b.exports=d},{}],8:[function(a,b,c){var d=a("./back-btn.js"),e=wp.media.view.Frame.extend({tagName:"div",className:"wpaas-stock-photos stock-photo-preview",events:{"click a.license-details":"showLicenseDetails"},initialize:function(){this.createToolbar(),this.createAttachmentPreview()},createToolbar:function(){var a;a={controller:this.controller},this.toolbar=new wp.media.view.Toolbar(a),this.views.add(this.toolbar);var b=new d({controller:this,collection:this.collection,priority:-80});this.listenToOnce(b,"close",this.close),this.toolbar.set("backBtn",b)},createAttachmentPreview:function(){this.attachmentPreview=new wp.media.View({controller:this.controller,tagName:"div",className:"stock-photo-image-preview"}),this.attachmentPreview.$el.html('<img src="'+this.model.get("sizes").preview.url+'"><a href="#" class="license-details">'+wpaas_stock_photos.license_text+"</a>"),this.views.add(this.attachmentPreview)},showLicenseDetails:function(a){a.preventDefault(),this.$el.find("a.license-details").replaceWith('<p class="license-details">'+wpaas_stock_photos.license_details+"</p>")},close:function(){this.unbind(),this.remove()}});b.exports=e},{"./back-btn.js":7}]},{},[3]);